"use strict";(self["webpackChunkweek03"]=self["webpackChunkweek03"]||[]).push([[445],{9284:function(t,a,e){e(7658);var s=e(2578),o=e(6294);a["Z"]=(0,s.Q_)("adminStore",{state:()=>({checkResult:null,tempProducts:[],api:{url:"https://vue3-course-api.hexschool.io/v2",path:"vue2022ron"},tempData:{},AllCategory:[""],operateMode:"",pagination:{},selectEl:null,uploadEl:null}),getters:{},actions:{getAllCategory(){this.axios.get(`${this.api.url}/api/${this.api.path}/admin/products/all`).then((t=>{const a=t.data.products,e=Object.keys(a);e.forEach((t=>{let e=0;this.AllCategory.forEach((s=>{s===a[t].category?e++:e+=0})),0===e&&this.AllCategory.push(a[t].category)}))})).catch((t=>{const a=(0,o.Z)(),{message:e}=t.response.data;a.swAlert("center","error",e,!1,!1)}))},selectOnChange(t){this.getProducts(t.target.value)},getProducts(t=""){this.axios.get(`${this.api.url}/api/${this.api.path}/admin/products/?category=${t}`).then((t=>{this.tempProducts=t.data.products,this.pagination=t.data.pagination})).catch((t=>{const a=(0,o.Z)(),{message:e}=t.response.data;a.swAlert("center","error",e,!1,!1)}))},checkStatus(){(async()=>{const t=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");this.axios.defaults.headers.common["Authorization"]=t;try{const t=await this.axios.post(`${this.api.url}/api/user/check`);this.checkResult=t.data.success,this.getProducts()}catch(a){const{message:t}=a.response.data,e=(0,o.Z)();await e.swAlert("center","error",t,!1,!1),this.router.push("/login")}})()},add(t){(async()=>{const a=(0,o.Z)();try{const e=await this.axios.post(`${this.api.url}/api/${this.api.path}/admin/product`,{data:t});this.getProducts(this.selectEl.value),a.swAlert("top-end","success",e.data.message,!1,!0)}catch(e){a.swAlert("top-end","error",e.response.data.message,!1,!0)}})()},put(t,a){(async()=>{const e=(0,o.Z)();try{const s=await this.axios.put(`${this.api.url}/api/${this.api.path}/admin/product/${t}`,{data:a});this.getProducts(this.selectEl.value),await e.swAlert("top-end","success",s.data.message,!1,!0)}catch(s){e.swAlert("top-end","error",s.response.data.message,!1,!0)}})()},uploadFile(){if(""===this.uploadEl.value)return;const t=this.uploadEl.files[0],a=new FormData;a.append("file-to-upload",t),this.axios.post(`${this.api.url}/api/${this.api.path}/admin/upload`,a).then((t=>{this.Swal.fire({title:"上傳成功",html:'<input class="form-control imageUrl" id="imageUrl" type="text" value="1234">',didOpen:()=>{document.querySelector(".imageUrl").value=t.data.imageUrl},icon:"success",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"複製圖片位置 ",cancelButtonText:"取消"}).then((t=>{if(t.isConfirmed){const t=document.querySelector(".imageUrl");navigator.clipboard.writeText(t.value),this.uploadEl.value=""}}))})).catch((t=>{this.Swal.fire("上傳失敗",t.message,"error")}))},changePage(t){this.axios.get(`${this.api.url}/api/${this.api.path}/admin/products/?page=${t}`).then((t=>{this.tempProducts=t.data.products,this.pagination=t.data.pagination})).catch((t=>{const a=(0,o.Z)();a.swAlert("top-end","error",t.response.data,!1,!0)}))},changeStatus(t){const{id:a}=t,e={...t};e.is_enabled=!e.is_enabled,this.put(a,e)},confirmProduct(){const{id:t}=this.tempData;"edit"===this.operateMode?this.put(t,this.tempData):"add"===this.operateMode&&this.add(this.tempData)},itemSort(t){this.tempProducts.sort(((a,e)=>e[t]-a[t]))}}})},6294:function(t,a,e){e(7658);var s=e(2578),o=e(9284);a["Z"]=(0,s.Q_)("statusStore",{state:()=>({api:{url:"https://vue3-course-api.hexschool.io/v2",path:"vue2022ron"}}),getters:{},actions:{swAlert(t,a,e,s,o){return new Promise(((i,r)=>{i(this.Swal.fire({position:t,icon:a,title:e,showConfirmButton:s,timer:2500,toast:o}))}))},swDelect(t){this.Swal.fire({title:`刪除產品『${t.title}』?`,text:"資料刪除後，將無法恢復！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"確認刪除",cancelButtonText:"取消"}).then((a=>{a.isConfirmed&&this.axios.delete(`${this.api.url}/api/${this.api.path}/admin/product/${t.id}`).then((t=>{this.Swal.fire(t.data.message,"你的資料已被刪除","success");const a=(0,o.Z)();this.axios.get(`${this.api.url}/api/${this.api.path}/admin/products/?category=${a.selectEl.value}`).then((t=>{a.tempProducts=t.data.products})).catch((t=>{this.swAlert("center","error",t.response.data.message,!1,!0)}))})).catch((t=>{this.Swal.fire(t.response.data.message,"你的資料尚未被刪除","error")}))}))},logout(){this.Swal.fire({title:"是否『登出』後台",text:"",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"確認登出",cancelButtonText:"取消"}).then((t=>{t.isConfirmed&&this.axios.post(`${this.api.url}/logout`).then((t=>{this.Swal.fire(t.data.message,"","success").then((t=>{t.isConfirmed&&this.router.push("/login")}))})).catch((t=>{this.Swal.fire(t.response.data.message,"","error")}))}))}}})},2445:function(t,a,e){e.r(a),e.d(a,{default:function(){return y}});var s=e(3396),o=e(7139);const i={class:"container"},r={class:"row vh-100 d-flex flex-column align-items-center"},n={class:"col-6 col-sm-6 col-md-4 col-lg-3 mt-auto mb-auto"},l=(0,s._)("h1",{class:"h3 mb-3 font-weight-normal text-center"},"請先登入",-1),c={class:"form-floating mb-3"},d=(0,s._)("label",{for:"account"},"Email address",-1),u={class:"form-floating"},p=(0,s._)("label",{for:"password"},"Password",-1),h=(0,s._)("button",{type:"submit",class:"btn btn-lg btn-primary mt-3 w-100"},"登入",-1);function m(t,a,e,m,g,w){const f=(0,s.up)("v-field"),v=(0,s.up)("error-message"),x=(0,s.up)("v-form");return(0,s.wg)(),(0,s.iD)("div",i,[(0,s._)("div",r,[(0,s._)("div",n,[(0,s.Wm)(x,{onSubmit:a[2]||(a[2]=t=>m.login.signin())},{default:(0,s.w5)((({errors:t})=>[l,(0,s._)("div",c,[(0,s.Wm)(f,{type:"email",name:"email",class:(0,o.C_)(["form-control",{"is-invalid":t["email"],"is-valid":""!==m.login.adminData.username&&!t["email"]}]),id:"account",placeholder:"name@example.com",rules:"email|required",modelValue:m.login.adminData.username,"onUpdate:modelValue":a[0]||(a[0]=t=>m.login.adminData.username=t)},null,8,["class","modelValue"]),d,(0,s.Wm)(v,{name:"email",class:"invalid-feedback"})]),(0,s._)("div",u,[(0,s.Wm)(f,{type:"password",name:"password",class:(0,o.C_)(["form-control",{"is-invalid":t["password"],"is-valid":""!==m.login.adminData.password&&!t["password"]}]),id:"password",placeholder:"Password",rules:m.login.isPassword,modelValue:m.login.adminData.password,"onUpdate:modelValue":a[1]||(a[1]=t=>m.login.adminData.password=t)},null,8,["class","rules","modelValue"]),p,(0,s.Wm)(v,{name:"password",class:"invalid-feedback"})]),h])),_:1})])])])}e(7658);var g=e(2578),w=e(6294),f=(0,g.Q_)("loginStore",{state:()=>({adminData:{username:"",password:""}}),getters:{},actions:{searchContacts(t){t()},test(t){const a={fn1:()=>{console.log("a")},fn2:()=>{console.log("b")}};this.searchContacts(a[t])},signin(){const t={url:"https://vue3-course-api.hexschool.io/v2",path:"vue2022ron"},a=(0,w.Z)(),{swAlert:e}=a;void 0!==this.adminData.username&&void 0!==this.adminData.password&&(async()=>{try{const a=await this.axios.post(`${t.url}/admin/signin`,this.adminData);this.cleanInputValue();const{expired:s,message:o,token:i}=a.data;document.cookie=`myToken = ${i}; expires = ${new Date(s)};`,await e("center","success",o,!1,!1),this.router.push("/week05")}catch(a){const{message:t}=a.response.data;this.cleanInputValue(),e("center","error",t,!1,!1)}})()},cleanInputValue(){this.adminData.username="",this.adminData.password=""},isPassword(t){const a=/^[a-zA-Z]\w{8}$/;return!!a.test(t)||"密碼為字母開頭，長度9字元"}}}),v={setup(){const t=f();return{login:t}}},x=e(89);const $=(0,x.Z)(v,[["render",m]]);var y=$}}]);
//# sourceMappingURL=445.5fb5f586.js.map